# yaml-language-server: $schema=https://goreleaser.com/static/schema.json
env_files:
  github_token: ~/dev/dns-heaven/github_token
builds:
  - main: cmd/dns-heaven/main.go
    binary: dns-heaven
    goos:
      - darwin
    goarch:
      - amd64
      - arm64
    ldflags: |-
      -X main.Version={{.Version}}

brews:
  - name: dns-heaven
    url_template: "https://github.com/kcaebe/dns-heaven/releases/download/{{ .Tag }}/{{ .ArtifactName }}"
    homepage: "https://github.com/kcaebe/dns-heaven"
    description: "Fixes stupid macOS DNS stack (/etc/resolv.conf)"
    tap:
      owner: kcaebe
      name: homebrew-dns-heaven
      branch: main
    folder: Formula
    dependencies:
      - name: go
    plist: |
      <?xml version="1.0" encoding="UTF-8"?>
      <!DOCTYPE plist PUBLIC "-//Apple//DTD PLIST 1.0//EN" "http://www.apple.com/DTDs/PropertyList-1.0.dtd">
      <plist version="1.0">
      <dict>
          <key>Label</key>
          <string>com.greenboxal.dnsheaven</string>
          <key>ProgramArguments</key>
          <array>
              <string>sudo</string>
              <string>#{bin}/dns-heaven</string>
          </array>
          <key>KeepAlive</key>
          <true/>
          <key>RunAtLoad</key>
          <true/>
      </dict>
      </plist>
    test: |
      system "#{bin}/dns-heaven -version"
